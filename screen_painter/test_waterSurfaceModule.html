<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">

    <style>
        #marker_receiver_canvas {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        water-surface-canvas {
            position: absolute;
            left: 0;
            top: 0;
        }
    </style>

    <script src="../libs/hammer.min.js"></script>
    <script src="../libs/Colors.js/Colors.js"></script>
</head>

<body>
    <water-surface-canvas></water-surface-canvas>
    <canvas id="marker_receiver_canvas"></canvas>
    <div id="video_controller"></div>

    <script type="module">
        import "./waterSurfaceModule.js";
        const water_surface_elem = document.querySelector("water-surface-canvas");

        const img = new Image();
        img.src = "./images/iu_front.png";
        img.onload = () => {
            water_surface_elem.init({ width: img.width, height: img.height });
            water_surface_elem.getContext().drawImage(img, 0, 0, img.width, img.height)
        }

        const marker_canvas_elem = document.querySelector("#marker_receiver_canvas");
        ({ width: marker_canvas_elem.width, height: marker_canvas_elem.height } = marker_canvas_elem.getBoundingClientRect());
        ["pointerenter", "pointermove", "pointerleave"].forEach(name => {
            marker_canvas_elem.addEventListener(name, (ev) => {
                water_surface_elem._onMouseMove(ev)
            });
        });
        ["touchstart", "touchmove", "touchend"].forEach(name => {
            marker_canvas_elem.addEventListener(name, ev => {
                // console.log(name, ev)
                // water_surface_elem._onMouseMove(ev);
            });
        });
        import { marker_receiver } from "./marker_receiver.mjs";
        marker_receiver.init({ canvas_elem: marker_canvas_elem });

        import { camera } from "../libs/webcamera/camera.js";
        // await camera.init({
        //     video_controller_elem: document.getElementById("video_controller"),
        //     video_resolution: [1024, 768],
        //     recognition_canvas_resolution: [320, 180],
        // });

        const render = () => {
            // camera.render();
            marker_receiver.render();
            requestAnimationFrame(render);
        }
        requestAnimationFrame(render);
    </script>
</body>

</html>